---
title: "Splitting St Paul's Parish in Half"
author: "Dave & Shiobhan"
format: html
editor: visual
---

## Introduction

## Libraries

```{r libraries}
library(fs)
library(here)

library(sf)
library(ggplot2)
library(dplyr)
library(vroom)
```

## Load Data

```{r load_data}
#| cache: true
parish_query <-
  "SELECT parish_code, parish_name FROM \"coe-parishes_2022\" WHERE parish_code = 550049"

parish <- read_sf(here("parish-shapes", "coe-parishes_2022.geojson"),
                  query = parish_query)

llsoa <- read_sf(here("civic-areas",
                      "2011_lsoa-boundaries_england-wales_generalised-clipped"))

oa <- read_sf(here("civic-areas",
                   "2021_oa-boundaries_england-wales_generalised_clipped"))

imd <- vroom(here("small-area-stats", "imd_2019.csv"))
```

## Find intersecting LLSOA

### Reproject parish shape

We need to reproject `parish` using (`st_transform`) so that it shares the same projection as `llsoa`. This will enable us to find those LLSOA that intersect the parish.

```{r reproject_parish}
parish <- st_transform(parish, crs = st_crs(llsoa))
```

### Find intersecting LLSOA

Use `st_intersects()` to determine which LLSOA intersect the parish

```{r find_intersecting_llsoa}
intersecting_llsoa <-
  st_intersects(llsoa, parish, sparse = FALSE) |> 
  as.vector()

llsoa <- filter(llsoa, intersecting_llsoa)
```

## Join IMD data to LLSOA

`left_join()` IMD data to `llsoa` by LLSOA code
